!function(a){a.fn.html5Uploader=function(b){var c={accept:["image/png","image/jpeg","image/gif"],url:null,fields:null,holder:null,progress:null,preview:null,complete:null,currentProgress:0},d=a.extend(c,b),e={image:["image/png","image/jpeg","image/gif"]},f={filereader:"undefined"!=typeof FileReader,dnd:"draggable"in document.createElement("span"),formdata:!!window.FormData,progress:"upload"in new XMLHttpRequest},g=function(b,c){console.log("fileselect",c),d.url||console.log("no url set");var g=f.formdata===!0?new FormData:null;if(f.formdata===!0){console.log("formdata supported"),d.progress&&0!=d.currentProgress&&(console.log("progress",0),d.currentProgress=0,d.progress(0)),g.append("file",c),d.fields&&a.each(d.fields,function(a,b){g.append(a,b)});var h=new XMLHttpRequest;h.onload=function(){if(d.progress&&100!=d.currentProgress&&(console.log("progress",100),d.currentProgress=100,d.progress(100)),b.target.responseText){var a=JSON.parse(b.target.responseText);d.complete&&d.complete(c,a)}},d.progress&&f.progress===!0&&(console.log("progress supported"),h.upload.onprogress=function(a){if(a.lengthComputable){var b=0|100*(a.loaded/a.total);d.currentProgress=b,console.log("progress",b),d.progress(b)}}),h.open("POST",d.url),h.send(g)}else d.complete&&d.complete(c);if(d.preview&&f.filereader===!0&&-1!=a.inArray(c.type,e.image)){console.log("filereader supported");var i=new FileReader;i.onload=function(a){d.preview(a.target.result)},i.readAsDataURL(c)}};return this.each(function(){var b=a(this);b.is("input")&&(f.dnd&&d.holder&&(console.log("dnd supported"),a(d.holder).on("dragover",function(){return a(this).addClass("hover"),b.addClass("disabled"),d.progress&&0!=d.currentProgress&&(console.log("progress",0),d.currentProgress=0,d.progress(0)),!1}).on("dragend",function(){return a(this).removeClass("hover"),b.removeClass("disabled"),d.progress&&0!=d.currentProgress&&(console.log("progress",0),d.currentProgress=0,d.progress(0)),!1}).on("drop",function(c){c.preventDefault(),c.dataTransfer=c.originalEvent.dataTransfer,a(this).removeClass("hover"),b.removeClass("disable");var e="undefined"!=c.dataTransfer&&c.dataTransfer.files.length?c.dataTransfer.files[0]:null;if(e){var f=a.inArray(e.type,d.accept);console.log("file chosen",e,f),-1!=f&&(console.log("acceptable mime type",e.type,d.accept),g(c,e))}})),b.change(function(){var c=a(this).get(0).files[0];if(d.progress&&0!=d.currentProgress&&(console.log("progress",0),d.currentProgress=0,d.progress(0)),c){var e=a.inArray(c.type,d.accept);console.log("file chosen",c,e),-1!=e&&(console.log("acceptable mime type",c.type,d.accept),a(this).trigger("fileselect",c))}}).on("fileselect",g))})}}(jQuery);